
# FASTAPI - Template


## Backend Requirements
- FastAPI [Github Repo](https://fastapi.tiangolo.com/)
-- Alembic [Docs]([https://alembic.sqlalchemy.org/en/latest/](https://alembic.sqlalchemy.org/en/latest/)) : For SQL Database Migrations
-- Celery for Tasks [Docs](http://www.celeryproject.org/)

## Backend local development

* Start the virtualenv with pipenv into the root folder:
Instructions to install [here](https://docs.pipenv.org/en/latest/)
```bash
pipenv shell
```
* Now install the dependecies on Pipfile:
```bash
pipenv install
```
* Everthing is set up now apply the migrations on the database:
```bash
alembic upgrade head
```
* And run locally:
```bash
uvicorn app.main:app --reload
```
** For more flags visit [here](https://www.uvicorn.org/)


* Now you can open your browser and interact with these URLs:

Backend, JSON based web API based on OpenAPI: http://localhost/api/

Automatic interactive documentation with Swagger UI (from the OpenAPI backend): http://localhost/docs

Alternative automatic documentation with ReDoc (from the OpenAPI backend): http://localhost/redoc


## Backend local development, additional details

### General workflow

Open your editor at `./app/` . That way, your editor will be able to find all the imports, etc.
  
Modify or add SQLAlchemy models in `./app/app/db_models/`, Pydantic models in `./app/app/models/`, API endpoints in `./app/app/api/`, CRUD (Create, Read, Update, Delete) utils in `./app/app/crud/`. The easiest might be to copy the ones for Items (models, endpoints, and CRUD utils) and update them to your needs.

 
### Backend tests

The tests run with Pytest, modify and add tests to `./backend/app/app/tests/`.

If you need to install any additional package for the tests, add it to the file `./app/Pipfile`.

### Migrations

Make sure you create a "revision" of your models and that you "upgrade" your database with that revision every time you change them. As this is what will update the tables in your database. Otherwise, your application will have errors.

* If you created a new model in `./app/app/db_models/`, make sure to import it in `./app/app/db/base.py`, that Python module (`base.py`) that imports all the models will be used by Alembic.
* After changing a model (for example, adding a column), inside the container, create a revision, e.g.:
```bash
alembic revision --autogenerate -m "Add column last_name to User model"
```
* Commit to the git repository the files generated in the alembic directory.
* After creating the revision, run the migration in the database (this is what will actually change the database):

```bash
alembic upgrade head
```
If you don't want to use migrations at all, uncomment the line in the file at `./backend/app/app/db/init_db.py` with:
```python
Base.metadata.create_all(bind=engine)
```
and comment the line in the file `prestart.sh` that contains:
```bash
alembic upgrade head
```
If you don't want to start with the default models and want to remove them / modify them, from the beginning, without having any previous revision, you can remove the revision files (`.py` Python files) under `./backend/app/alembic/versions/`. And then create a first migration as described above.

## TODO

- PGAdmin, PostgreSQL web administration
- Flower, administration of Celery tasks: http://localhost:5555
- NoSQL Integration with MotorDriver (Async MongoDB Driver)

- Dockernize applications:
-- Celery
-- Pgadmin
-- Flower
- Create a template using cookie-cutter **TODO**
- Tests the tests :ok_hand:


## URLs

 These are the URLs that will be used and generated by the project.

 ### Production

Production URLs, from the branch `production`.
Backend: https://none/api/
Automatic Interactive Docs (Swagger UI): https://none/docs
Automatic Alternative Docs (ReDoc): https://none/redoc
PGAdmin: https://pgadmin.none **TODO**
Flower: https://flower.none **TODO**

### Staging

Staging URLs, from the branch `master`.
Backend: https://none/api/
Automatic Interactive Docs (Swagger UI): https://none/docs
Automatic Alternative Docs (ReDoc): https://none/redoc
PGAdmin: https://pgadmin.none **TODO**
Flower: https://flower.none **TODO**

### Development

Development URLs, for local development.
Backend: http://localhost/api/
Automatic Interactive Docs (Swagger UI): https://localhost/docs
Automatic Alternative Docs (ReDoc): https://localhost/redoc
PGAdmin: http://localhost:5050 **TODO**
Flower: http://localhost:5555 **TODO**
  

### Development with Docker Toolbox

Development URLs, for local development.
Backend: http://local.dockertoolbox.tiangolo.com/api/
Automatic Interactive Docs (Swagger UI): https://local.dockertoolbox.tiangolo.com/docs
Automatic Alternative Docs (ReDoc): https://local.dockertoolbox.tiangolo.com/redoc
PGAdmin: http://local.dockertoolbox.tiangolo.com:5050 **TODO**
Flower: http://local.dockertoolbox.tiangolo.com:5555 **TODO**
  
### Development with a custom IP

Development URLs, for local development.
Backend: http://dev.none/api/
Automatic Interactive Docs (Swagger UI): https://dev.none/docs
Automatic Alternative Docs (ReDoc): https://dev.none/redoc
PGAdmin: http://dev.none:5050 **TODO**
Flower: http://dev.none:5555 **TODO**

### Development in localhost with a custom domain
Development URLs, for local development.
Backend: http://localhost.tiangolo.com/api/
Automatic Interactive Docs (Swagger UI): https://localhost.tiangolo.com/docs
Automatic Alternative Docs (ReDoc): https://localhost.tiangolo.com/redoc
PGAdmin: http://localhost.tiangolo.com:5050 **TODO**
Flower: http://localhost.tiangolo.com:5555 **TODO**
  

## Project generation and updating, or re-generating - WIP

Create a template using cookie-cutter **TODO**
